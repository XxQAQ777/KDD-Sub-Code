# ğŸ‰ HimNetæµ‹è¯•è„šæœ¬å®Œæˆæ€»ç»“

## âœ… ä»»åŠ¡å®ŒæˆçŠ¶æ€

- âœ… åˆ›å»ºäº†ä¸STGCNå®Œå…¨ä¸€è‡´çš„æµ‹è¯•è„šæœ¬
- âœ… å®ç°äº†CRPSå’ŒWasserstein Distanceä¸¤ä¸ªæ–°æŒ‡æ ‡
- âœ… ç»˜å›¾é£æ ¼ä¸STGCNå®Œå…¨ä¸€è‡´
- âœ… æ¥å£å‚æ•°ä¸STGCNå®Œå…¨ä¸€è‡´
- âœ… åˆ›å»ºäº†å®Œæ•´çš„æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶ç»“æ„

```
/home/xiaoxiao/HimNet-main/
â”‚
â”œâ”€â”€ ğŸ¯ ä¸»è¦æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test_and_plot.py (22K)           â­ æ–°ï¼šSTGCNé£æ ¼ï¼Œå«CRPS/WD
â”‚   â””â”€â”€ test_comparison.py (17K)         åŸæœ‰ï¼šæ‰¹é‡å¯¹æ¯”æµ‹è¯•
â”‚
â”œâ”€â”€ ğŸš€ å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ run_test_and_plot.sh (1.4K)     â­ æ–°ï¼šå¿«é€Ÿå¯åŠ¨test_and_plot.py
â”‚   â”œâ”€â”€ run_test_comparison.sh (1.1K)   åŸæœ‰ï¼šå¿«é€Ÿå¯åŠ¨test_comparison.py
â”‚   â””â”€â”€ example_complete_test.sh (2.8K) â­ æ–°ï¼šå®Œæ•´æµ‹è¯•ç¤ºä¾‹
â”‚
â”œâ”€â”€ ğŸ“š test_and_plot.py æ–‡æ¡£ï¼ˆæ–°ï¼‰
â”‚   â”œâ”€â”€ TEST_AND_PLOT_README.md (7.2K)      è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â”‚   â”œâ”€â”€ TEST_AND_PLOT_QUICKSTART.md (7.6K) å¿«é€Ÿå¼€å§‹æŒ‡å—
â”‚   â””â”€â”€ TEST_AND_PLOT_SUMMARY.md (7.8K)    åŠŸèƒ½å®Œæ•´æ€»ç»“
â”‚
â”œâ”€â”€ ğŸ“š test_comparison.py æ–‡æ¡£ï¼ˆåŸæœ‰ï¼‰
â”‚   â”œâ”€â”€ TEST_COMPARISON_README.md (5.5K)   è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â”‚   â””â”€â”€ QUICKSTART.md (4.6K)               å¿«é€Ÿå¼€å§‹æŒ‡å—
â”‚
â””â”€â”€ ğŸ“– æ€»ä½“æ–‡æ¡£
    â””â”€â”€ README_TESTING.md (7.9K)           â­ æ–°ï¼šå®Œæ•´æµ‹è¯•æŒ‡å—
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ç‰¹æ€§ | test_and_plot.py | test_comparison.py |
|---------|------------------|-------------------|
| **æ¥å£é£æ ¼** | å‘½ä»¤è¡Œå‚æ•°ï¼ˆSTGCNé£æ ¼ï¼‰âœ… | ç¡¬ç¼–ç é…ç½® |
| **è¯„ä¼°æŒ‡æ ‡** | 5ä¸ªï¼ˆMAE/MAPE/RMSE/CRPS/WDï¼‰âœ… | 3ä¸ªï¼ˆMAE/MAPE/RMSEï¼‰ |
| **å¯è§†åŒ–** | 5ç§å›¾è¡¨ | 6ç§å›¾è¡¨ |
| **CSVå¯¼å‡º** | âœ… è¯¦ç»†+æ±‡æ€» | âŒ |
| **æ‰¹é‡æµ‹è¯•** | æ‰‹åŠ¨æŒ‡å®š | è‡ªåŠ¨æ‰¹é‡ âœ… |
| **çµæ´»æ€§** | â­â­â­â­â­ | â­â­â­ |

## ğŸ”¥ æ–°å¢çš„ä¸¤ä¸ªæŒ‡æ ‡

### 1. CRPS (Continuous Ranked Probability Score)
```python
def compute_crps(pred, real):
    """å¯¹äºç¡®å®šæ€§é¢„æµ‹ï¼ŒCRPSç®€åŒ–ä¸ºMAE"""
    crps = np.mean(np.abs(pred - real))
    return crps
```

**æ˜¾ç¤ºä½ç½®ï¼š**
- âœ… æ§åˆ¶å°è¾“å‡ºï¼ˆæ¯12æ­¥ï¼‰
- âœ… metrics_over_horizons.pngï¼ˆç¬¬4ä¸ªå­å›¾ï¼‰
- âœ… metrics_detailed.csvï¼ˆCRPSåˆ—ï¼‰
- âœ… metrics_summary.txtï¼ˆæ±‡æ€»ç»Ÿè®¡ï¼‰

### 2. Wasserstein Distance (Earth Mover's Distance)
```python
def compute_wasserstein(pred, real):
    """ä½¿ç”¨scipyè®¡ç®—1-Wassersteinè·ç¦»"""
    from scipy.stats import wasserstein_distance
    wd = wasserstein_distance(pred.flatten(), real.flatten())
    return wd
```

**æ˜¾ç¤ºä½ç½®ï¼š**
- âœ… æ§åˆ¶å°è¾“å‡ºï¼ˆæ¯12æ­¥ï¼‰
- âœ… metrics_over_horizons.pngï¼ˆç¬¬5ä¸ªå­å›¾ï¼‰
- âœ… prediction_vs_groundtruth.pngï¼ˆæ ‡é¢˜ä¸­ï¼‰
- âœ… metrics_detailed.csvï¼ˆWasserstein_Distanceåˆ—ï¼‰
- âœ… metrics_summary.txtï¼ˆæ±‡æ€»ç»Ÿè®¡ï¼‰

## ğŸ“Š ç”Ÿæˆçš„å¯è§†åŒ–å›¾è¡¨

### test_and_plot.py ç”Ÿæˆï¼ˆ5ç§ï¼‰

#### 1. metrics_over_horizons.png (2x3å¸ƒå±€)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MAEè¶‹åŠ¿   â”‚  MAPEè¶‹åŠ¿   â”‚  RMSEè¶‹åŠ¿   â”‚
â”‚  (è“è‰²åœ†ç‚¹) â”‚ (æ©™è‰²æ–¹å—)  â”‚ (ç»¿è‰²ä¸‰è§’)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CRPSè¶‹åŠ¿   â”‚   WDè¶‹åŠ¿    â”‚  ç»¼åˆå¯¹æ¯”   â”‚
â”‚ (ç´«è‰²è±å½¢)  â”‚  (çº¢è‰²æ˜Ÿ)   â”‚ (5æ¡å½’ä¸€åŒ–) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. prediction_vs_groundtruth.png
- 4ä¸ªå…³é”®æ—¶é—´æ­¥çš„æ•£ç‚¹å›¾
- åŒ…å«å®Œç¾é¢„æµ‹çº¿
- æ˜¾ç¤ºMAEå’ŒWD

#### 3. time_series_predictions.png
- 3ä¸ªèŠ‚ç‚¹ Ã— 5ä¸ªæ ·æœ¬
- Ground Truth vs Prediction

#### 4. error_distribution.png
- 4ä¸ªæ—¶é—´æ­¥çš„è¯¯å·®ç›´æ–¹å›¾
- æ˜¾ç¤ºå‡å€¼å’Œæ ‡å‡†å·®

#### 5. spatial_error_heatmap.png
- æ¯ä¸ªèŠ‚ç‚¹çš„å¹³å‡MAE
- YlOrRdé¢œè‰²æ˜ å°„

## ğŸš€ ä½¿ç”¨æ–¹æ³•å¯¹æ¯”

### test_and_plot.pyï¼ˆæ–°ï¼‰- STGCNé£æ ¼

```bash
# æ–¹å¼1ï¼šæœ€ç®€å•
python3 test_and_plot.py --dataset METRLA

# æ–¹å¼2ï¼šä½¿ç”¨Shellè„šæœ¬
./run_test_and_plot.sh METRLA cuda:0

# æ–¹å¼3ï¼šå®Œæ•´å‚æ•°
python3 test_and_plot.py \
    --dataset PEMSBAY \
    --model_path saved_models/xxx.pt \
    --device cuda:0 \
    --seed 42 \
    --cpus 4

# æŸ¥çœ‹å¸®åŠ©
python3 test_and_plot.py --help
```

### test_comparison.pyï¼ˆåŸæœ‰ï¼‰- æ‰¹é‡æµ‹è¯•

```bash
# æ–¹å¼1ï¼šç›´æ¥è¿è¡Œ
python3 test_comparison.py

# æ–¹å¼2ï¼šä½¿ç”¨Shellè„šæœ¬
./run_test_comparison.sh

# è‡ªåŠ¨æµ‹è¯•ä¸¤ä¸ªæ•°æ®é›†ï¼š
# - METRLA: epoch24
# - PEMSBAY: epoch13
```

## ğŸ“ˆ è¾“å‡ºå¯¹æ¯”

### test_and_plot.py è¾“å‡º

```
test_results_METRLA_20260115_123456/
â”œâ”€â”€ ğŸ“Š å¯è§†åŒ–å›¾è¡¨ï¼ˆ5å¼ PNGï¼‰
â”‚   â”œâ”€â”€ metrics_over_horizons.png          â­ 5æŒ‡æ ‡ (2x3)
â”‚   â”œâ”€â”€ prediction_vs_groundtruth.png      æ•£ç‚¹å›¾
â”‚   â”œâ”€â”€ time_series_predictions.png        æ—¶é—´åºåˆ—
â”‚   â”œâ”€â”€ error_distribution.png             è¯¯å·®åˆ†å¸ƒ
â”‚   â””â”€â”€ spatial_error_heatmap.png          ç©ºé—´çƒ­åŠ›å›¾
â”‚
â”œâ”€â”€ ğŸ’¾ æ•°æ®æ–‡ä»¶ï¼ˆ2ä¸ªNPYï¼‰
â”‚   â”œâ”€â”€ predictions.npy
â”‚   â””â”€â”€ ground_truth.npy
â”‚
â””â”€â”€ ğŸ“‘ æŒ‡æ ‡æŠ¥å‘Šï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰â­ æ–°å¢
    â”œâ”€â”€ metrics_detailed.csv               æ¯ä¸ªhorizonçš„5ä¸ªæŒ‡æ ‡
    â”œâ”€â”€ metrics_summary.csv                ç»Ÿè®¡æ±‡æ€»
    â””â”€â”€ metrics_summary.txt                å¯è¯»æ ¼å¼
```

### test_comparison.py è¾“å‡º

```
test_results_comparison_20260115_123456/
â”œâ”€â”€ METRLA/
â”‚   â”œâ”€â”€ ğŸ“Š å¯è§†åŒ–å›¾è¡¨ï¼ˆ6å¼ PNGï¼‰
â”‚   â”œâ”€â”€ ğŸ’¾ æ•°æ®æ–‡ä»¶ï¼ˆ2ä¸ªNPYï¼‰
â”‚   â””â”€â”€ ï¼ˆæ— CSVå¯¼å‡ºï¼‰
â”‚
â””â”€â”€ PEMSBAY/
    â””â”€â”€ ï¼ˆç›¸åŒç»“æ„ï¼‰
```

## ğŸ¨ ç»˜å›¾é£æ ¼éªŒè¯

### âœ… ä¸STGCNå®Œå…¨ä¸€è‡´

| é£æ ¼å…ƒç´  | STGCN | HimNet test_and_plot.py |
|---------|-------|------------------------|
| æ ·å¼ | seaborn-v0_8-darkgrid | âœ… ç›¸åŒ |
| è°ƒè‰²æ¿ | husl | âœ… ç›¸åŒ |
| åˆ†è¾¨ç‡ | 300 DPI | âœ… ç›¸åŒ |
| ç½‘æ ¼çº¿ | alpha=0.3 | âœ… ç›¸åŒ |
| æ ‡è®°å¤§å° | 4-8 | âœ… ç›¸åŒ |
| çº¿å®½ | 2 | âœ… ç›¸åŒ |
| æ ‡é¢˜å­—ä½“ | fontsize=14, bold | âœ… ç›¸åŒ |
| æ ‡ç­¾å­—ä½“ | fontsize=11-12 | âœ… ç›¸åŒ |

## ğŸ“– æ–‡æ¡£å®Œæ•´æ€§

### âœ… 7ä¸ªæ–‡æ¡£æ–‡ä»¶

1. **TEST_AND_PLOT_README.md** (7.2K)
   - å®Œæ•´çš„å‚æ•°è¯´æ˜
   - è¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹
   - æ•…éšœæ’é™¤æŒ‡å—

2. **TEST_AND_PLOT_QUICKSTART.md** (7.6K)
   - ä¸‰ç§ä½¿ç”¨æ–¹å¼
   - å¿«é€Ÿå¼€å§‹æ­¥éª¤
   - å¸¸è§é—®é¢˜FAQ

3. **TEST_AND_PLOT_SUMMARY.md** (7.8K)
   - åŠŸèƒ½å®Œæ•´æ€»ç»“
   - ä¸STGCNçš„å¯¹åº”å…³ç³»
   - å…³é”®ä»£ç è¯´æ˜

4. **README_TESTING.md** (7.9K)
   - ä¸¤å¥—è„šæœ¬å¯¹æ¯”
   - ä½¿ç”¨åœºæ™¯æ¨è
   - å®Œæ•´æ–‡ä»¶æ¸…å•

5. **TEST_COMPARISON_README.md** (5.5K)
   - test_comparison.pyè¯¦ç»†æ–‡æ¡£
   - ï¼ˆåŸæœ‰æ–‡ä»¶ï¼‰

6. **QUICKSTART.md** (4.6K)
   - test_comparison.pyå¿«é€Ÿå¼€å§‹
   - ï¼ˆåŸæœ‰æ–‡ä»¶ï¼‰

7. **æœ¬æ–‡ä»¶** - FINAL_SUMMARY.md
   - æ€»ä½“å®Œæˆæ€»ç»“

## ğŸ¯ ä¸éœ€æ±‚çš„å®Œå…¨åŒ¹é…

### âœ… éœ€æ±‚1ï¼šå‚ç…§STGCNè„šæœ¬é£æ ¼
- [x] å‘½ä»¤è¡Œå‚æ•°æ¥å£ï¼ˆargparseï¼‰
- [x] ç›¸åŒçš„å‚æ•°åç§°
- [x] ç›¸åŒçš„æ•°æ®é›†æ”¯æŒ
- [x] ç›¸åŒçš„è¾“å‡ºæ ¼å¼
- [x] ç›¸åŒçš„ä»£ç ç»“æ„

### âœ… éœ€æ±‚2ï¼šå¢åŠ CRPSå’ŒWasserstein Distance
- [x] CRPSå·²å®ç°
- [x] Wasserstein Distanceå·²å®ç°
- [x] åœ¨æ‰€æœ‰è¾“å‡ºä¸­æ˜¾ç¤º
- [x] å•ç‹¬çš„å¯è§†åŒ–å­å›¾
- [x] CSVæ–‡ä»¶ä¸­åŒ…å«

### âœ… éœ€æ±‚3ï¼šç»˜å›¾é£æ ¼ä¸€è‡´
- [x] seaborn-v0_8-darkgrid
- [x] huslè°ƒè‰²æ¿
- [x] 300 DPIé«˜åˆ†è¾¨ç‡
- [x] ç›¸åŒçš„å¸ƒå±€è®¾è®¡
- [x] ç›¸åŒçš„é¢œè‰²æ–¹æ¡ˆ

### âœ… éœ€æ±‚4ï¼šæ¥å£å‚æ•°ä¸€è‡´
- [x] --dataset
- [x] --model_path
- [x] --device
- [x] --seed
- [x] --cpus

## ğŸ“ ä½¿ç”¨å»ºè®®

### æ¨èä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èè„šæœ¬ | åŸå›  |
|-----|---------|------|
| æ—¥å¸¸æ¨¡å‹æµ‹è¯• | test_and_plot.py | çµæ´»ã€å¿«é€Ÿ |
| è®ºæ–‡å®éªŒç»“æœ | test_and_plot.py | CSVå¯¼å‡ºã€5æŒ‡æ ‡ |
| å¯¹æ¯”ä¸åŒepoch | test_and_plot.py | å‘½ä»¤è¡Œå‚æ•° |
| æ‰¹é‡æµ‹è¯•æ‰€æœ‰æ•°æ®é›† | test_comparison.py | è‡ªåŠ¨æ‰¹é‡ |
| å¿«é€ŸæŸ¥çœ‹æ•ˆæœ | ä¸¤è€…çš†å¯ | æ ¹æ®éœ€æ±‚ |

### æœ€ä½³å®è·µ

```bash
# 1. å¿«é€Ÿæµ‹è¯•å•ä¸ªæ¨¡å‹
python3 test_and_plot.py --dataset METRLA

# 2. è®ºæ–‡å®éªŒï¼ˆå›ºå®šéšæœºç§å­ï¼‰
python3 test_and_plot.py --dataset METRLA --seed 42

# 3. å¯¹æ¯”ä¸åŒcheckpoint
for epoch in 10 15 20 24; do
    python3 test_and_plot.py \
        --dataset METRLA \
        --model_path saved_models/*_epoch${epoch}.pt
done

# 4. æ‰¹é‡æµ‹è¯•æ‰€æœ‰æ•°æ®é›†
./example_complete_test.sh
```

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

### æ§åˆ¶å°è¾“å‡º

```
================================================================================
HimNet Model Testing and Visualization
================================================================================
Dataset: METRLA
Device: cuda:0
================================================================================

================================================================================
Testing Results on Test Set
================================================================================
All Steps | MAE: 3.1234 | MAPE: 0.0812 | RMSE: 5.6789 | CRPS: 3.1234 | WD: 1.2345
--------------------------------------------------------------------------------
Horizon   1 | MAE: 2.5678 | MAPE: 0.0654 | RMSE: 4.1234 | CRPS: 2.5678 | WD: 0.9876
Horizon  13 | MAE: 2.8901 | MAPE: 0.0723 | RMSE: 4.8765 | CRPS: 2.8901 | WD: 1.0987
Horizon  25 | MAE: 3.1234 | MAPE: 0.0801 | RMSE: 5.4321 | CRPS: 3.1234 | WD: 1.1543
...
Horizon 144 | MAE: 4.2345 | MAPE: 0.1123 | RMSE: 7.6543 | CRPS: 4.2345 | WD: 1.5678
================================================================================
Average over 144 horizons | MAE: 3.1234 | MAPE: 0.0812 | RMSE: 5.6789 | CRPS: 3.1234 | WD: 1.2345
================================================================================

Generating visualizations...
âœ… All plots saved
âœ… Predictions saved
âœ… Metrics saved to CSV

================================================================================
Testing and visualization completed successfully!
================================================================================
```

### CSVæ–‡ä»¶å†…å®¹ï¼ˆmetrics_summary.txtï¼‰

```
================================================================================
Metrics Summary
================================================================================

MAE:                3.123456 Â± 0.543210
MAPE:               0.081234 Â± 0.012345
RMSE:               5.678901 Â± 0.987654
CRPS:               3.123456 Â± 0.543210
Wasserstein Dist:   1.234567 Â± 0.234567

================================================================================

Detailed Statistics:
================================================================================
           Metric      Mean       Std       Min       Max
              MAE  3.123456  0.543210  2.567890  4.234567
             MAPE  0.081234  0.012345  0.065432  0.112345
             RMSE  5.678901  0.987654  4.123456  7.654321
             CRPS  3.123456  0.543210  2.567890  4.234567
Wasserstein_Di...  1.234567  0.234567  0.987654  1.567890
================================================================================
```

## âœ¨ äº®ç‚¹æ€»ç»“

1. **å®Œå…¨å…¼å®¹** - ä¸STGCNè„šæœ¬100%æ¥å£å…¼å®¹
2. **æ–°å¢æŒ‡æ ‡** - CRPSå’ŒWasserstein Distance
3. **CSVå¯¼å‡º** - è¯¦ç»†æŒ‡æ ‡å’Œç»Ÿè®¡æ±‡æ€»
4. **é«˜è´¨é‡å›¾è¡¨** - 300 DPIï¼Œé€‚åˆè®ºæ–‡å‘è¡¨
5. **çµæ´»æ˜“ç”¨** - å‘½ä»¤è¡Œå‚æ•°ï¼Œæ–¹ä¾¿è‡ªåŠ¨åŒ–
6. **æ–‡æ¡£é½å…¨** - 7ä¸ªæ–‡æ¡£ï¼Œè¦†ç›–æ‰€æœ‰ä½¿ç”¨åœºæ™¯
7. **Shellè„šæœ¬** - 3ä¸ªä¾¿æ·è„šæœ¬ï¼Œå¿«é€Ÿä¸Šæ‰‹

## ğŸ‰ å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼

```bash
# è¿›å…¥ç›®å½•
cd /home/xiaoxiao/HimNet-main

# æŸ¥çœ‹æ–‡æ¡£
cat TEST_AND_PLOT_QUICKSTART.md

# å¿«é€Ÿæµ‹è¯•
python3 test_and_plot.py --dataset METRLA

# æŸ¥çœ‹ç»“æœ
ls -la test_results_METRLA_*/
```

**ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸš€**
